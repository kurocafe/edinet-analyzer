# 要件定義書：EDINET財務ランキングシステム

## 1. プロジェクト概要

### 1.1 プロジェクト名
EDINET財務ランキングシステム

### 1.2 目的
- **学習目的**: Go言語、API連携、データ分析、Web開発の学習
- **実用目的**: IT・通信業界の企業財務データを自動収集・分析し、ランキング形式でWeb可視化

### 1.3 対象ユーザー
- 自分（kurocafe）- 学習と実用を兼ねる

### 1.4 背景
- 企業の財務データを手動で収集・分析するのは時間がかかる
- EDINET APIを使えば自動化できる
- ランキング形式で可視化すれば、業界の状況が一目で分かる

## 2. 機能要件

### 2.1 Phase 1: データ収集基盤（完了✅）
- 書類一覧APIの実装
- 指定日付の書類情報取得
- JSON形式のデータパース
- 企業情報の表示

### 2.2 Phase 2: データ保存・管理
- [ ] 取得データのCSV出力
- [ ] 複数日付の一括取得（並行処理）
- [ ] 有価証券報告書のフィルタリング
- [ ] IT・通信業界の企業リスト管理

### 2.3 Phase 3: 書類取得
- [ ] 書類取得APIの実装
- [ ] XBRLファイルのダウンロード
- [ ] ファイル管理（命名規則、ディレクトリ構成）

### 2.4 Phase 4: 財務データ抽出
- [ ] XBRLファイルのパース
- [ ] 以下の財務指標を抽出（過去3年分）:
  - 純利益
  - 配当金
  - 売上高
  - 営業利益
- [ ] データの構造化（CSV/データベース）

### 2.5 Phase 5: ランキング生成
- [ ] 利益成長率の計算
  - 計算式: (当期利益 - 前期利益) / 前期利益 × 100
- [ ] 配当利回りの計算
  - 計算式: 配当金 / 株価 × 100
  - ※株価データは外部APIまたは手動入力
- [ ] ランキングのソート処理
- [ ] 上位表示（トップ10など）

### 2.6 Phase 6: Web可視化
- [ ] Webページの生成
- [ ] ランキング表の表示
- [ ] グラフの表示:
  - 利益成長率の棒グラフ
  - 配当利回りの棒グラフ
  - 過去3年間の推移（折れ線グラフ）
- [ ] レスポンシブデザイン（スマホ対応）

## 3. 非機能要件

### 3.1 パフォーマンス
- 並行処理で複数企業のデータを効率的に取得
- 10〜15社程度のデータ処理は1分以内
- APIのレート制限を考慮

### 3.2 エラーハンドリング
- APIリクエスト失敗時の適切な処理
- XBRLパースエラー時の対応
- データ欠損時の処理

### 3.3 保守性
- コードは機能ごとにパッケージ分割
- 設定値は外部ファイル化
- テストコードの作成

### 3.4 拡張性
- 業界の追加が容易
- 指標の追加が容易
- グラフの種類追加が容易

## 4. 対象業界と企業

### 4.1 対象業界
IT・通信業界

### 4.2 対象企業（候補15社）

| 企業名 | 証券コード | 分類 |
|--------|-----------|------|
| ソニーグループ | 6758 | 電機・ゲーム |
| 任天堂 | 7974 | ゲーム |
| ソフトバンクグループ | 9984 | 通信・投資 |
| KDDI | 9433 | 通信 |
| NTT | 9432 | 通信 |
| 楽天グループ | 4755 | EC・通信 |
| サイバーエージェント | 4751 | ネット広告 |
| DeNA | 2432 | ゲーム |
| メルカリ | 4385 | EC |
| 富士通 | 6702 | IT |
| NEC | 6701 | IT |
| パナソニック | 6752 | 電機 |
| キーエンス | 6861 | 計測機器 |
| オムロン | 6645 | 電子部品 |
| 村田製作所 | 6981 | 電子部品 |

### 4.3 対象期間
過去5年分の財務データ（2019, 2020, 2021、2022、2023年度）

## 5. 技術スタック

### 5.1 システム構成
フロントエンドとバックエンドを分離したモダンなアーキテクチャ

```
┌─────────────┐
│  ブラウザ    │
└──────┬──────┘
       │
       ▼
┌─────────────────────┐
│  Nuxt.js (SSR)      │  ← localhost:3000
│  (フロントエンド)    │
└──────┬──────────────┘
       │ HTTP/REST API
       ▼
┌─────────────────────┐
│  Go (Gin)           │  ← localhost:8080
│  (バックエンドAPI)   │
└──────┬──────────────┘
       │
       ▼
┌─────────────────────┐
│  MySQL 8.0          │
│  (データベース)      │
└─────────────────────┘
```

### 5.2 バックエンド
- **言語**: Go 1.23
- **Webフレームワーク**: Gin
  - 高速なHTTPルーター
  - ミドルウェアサポート
  - JSON処理が簡単
- **ORM**: GORM 2.0
  - データベース操作を簡潔に
  - マイグレーション機能
  - リレーション管理
- **データベース**: MySQL 8.0
  - 本番環境でも広く使われている
  - トランザクション対応
  - インデックスによる高速検索
- **主要パッケージ**:
  - `github.com/gin-gonic/gin` - Webフレームワーク
  - `gorm.io/gorm` - ORM
  - `gorm.io/driver/mysql` - MySQLドライバー
  - `encoding/json` - JSONパース
  - `encoding/xml` - XBRLパース
  - `github.com/joho/godotenv` - 環境変数管理

### 5.3 フロントエンド
- **フレームワーク**: Nuxt.js 3
  - Vue 3ベースのフルスタックフレームワーク
  - SSR（サーバーサイドレンダリング）対応
  - ファイルベースルーティング
  - 自動インポート
- **UIフレームワーク**: Tailwind CSS
  - ユーティリティファーストCSS
  - レスポンシブデザイン対応
  - カスタマイズ性が高い
- **グラフライブラリ**: vue-chartjs + Chart.js
  - Vue 3対応
  - インタラクティブなグラフ
  - カスタマイズ可能
- **HTTPクライアント**: useFetch（Nuxt標準）
  - 自動的なデータフェッチ
  - SSR対応
  - キャッシング

### 5.4 開発環境
- **Docker Compose**
  - バックエンド（Go）コンテナ
  - フロントエンド（Nuxt.js）コンテナ
  - MySQL コンテナ
- **ホットリロード**
  - Go: Air
  - Nuxt.js: 標準機能
- **バージョン管理**: Git
- **環境変数管理**: .env ファイル

### 5.5 プロジェクト構成
```
edinet-ranking/
├── backend/                    # Goプロジェクト
│   ├── main.go
│   ├── go.mod
│   ├── config/
│   ├── models/                # GORMモデル
│   ├── handlers/              # Ginハンドラー
│   ├── services/              # ビジネスロジック
│   ├── repositories/          # データアクセス層
│   ├── middlewares/           # ミドルウェア
│   └── Dockerfile
│
├── frontend/                   # Nuxt.jsプロジェクト
│   ├── package.json
│   ├── nuxt.config.ts
│   ├── pages/                 # ページコンポーネント
│   ├── components/            # 再利用コンポーネント
│   ├── composables/           # Composition API
│   ├── assets/
│   └── Dockerfile
│
├── docker-compose.yml
├── .env
└── README.md
```

## 6. API設計

### 6.1 REST APIエンドポイント

**ベースURL**: `http://localhost:8080/api/v1`

#### **ランキング関連**
```
GET  /rankings/growth          # 利益成長率ランキング取得
GET  /rankings/dividend        # 配当利回りランキング取得
```

**レスポンス例（利益成長率）:**
```json
{
  "year": 2023,
  "industry": "IT・通信",
  "rankings": [
    {
      "rank": 1,
      "company": {
        "id": 1,
        "name": "任天堂",
        "secCode": "7974"
      },
      "growthRate": 85.2,
      "prevIncome": 432100000000,
      "currentIncome": 800500000000
    }
  ]
}
```

#### **企業関連**
```
GET  /companies                # 企業一覧取得
GET  /companies/:secCode       # 企業詳細取得
GET  /companies/:secCode/history  # 企業の財務履歴取得
```

#### **データ取得（管理者用）**
```
POST /admin/fetch              # EDINETからデータ取得
POST /admin/sync               # データベース同期
```

### 6.2 CORS設定
```go
// フロントエンド（localhost:3000）からのアクセスを許可
router.Use(cors.New(cors.Config{
    AllowOrigins: []string{"http://localhost:3000"},
    AllowMethods: []string{"GET", "POST", "PUT", "DELETE"},
}))
```

## 7. 使用するAPI

### 7.1 EDINET API
**書類一覧API**
- エンドポイント: `https://api.edinet-fsa.go.jp/api/v2/documents.json`
- パラメータ: date, type, Subscription-Key

**書類取得API**
- エンドポイント: `https://api.edinet-fsa.go.jp/api/v2/documents/{docID}`
- パラメータ: type, Subscription-Key

### 6.2 株価API（検討中）
配当利回り計算のため、株価データが必要
- Yahoo Finance API
- または手動入力・CSV取り込み

## 7. 画面イメージ

### 7.1 トップページ
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   IT・通信業界 財務ランキング 2023
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【利益成長率ランキング】
順位  企業名              成長率    グラフ
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
1位   任天堂              +85.2%    ████████
2位   ソニーグループ      +52.3%    █████
3位   キーエンス          +38.7%    ████
...

【配当利回りランキング】
順位  企業名              利回り    グラフ
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
1位   NTT                 3.8%      ████
2位   KDDI                3.5%      ███
3位   ソフトバンク        3.2%      ███
...
```

## 8. データ仕様

### 8.1 抽出データ項目
- 企業名
- 証券コード
- 純利益
- 配当金
- 売上高
- 営業利益

### 8.2 計算項目
- 利益成長率（2022→2023）
- 配当利回り（2023年度）

### 8.3 データ更新頻度
- 手動実行
- 将来的に定期実行も検討（月次更新など）

## 9. 制約事項

### 9.1 EDINET API
- APIキーの取得が必要
- 利用規約の遵守
- レート制限の考慮（連続リクエストに注意）

### 9.2 株価データ
- 配当利回り計算には最新株価が必要
- 株価データの取得方法は別途検討

### 9.3 XBRLデータ
- XBRLの構造が複雑
- 企業によってタグ名が異なる可能性
- データ欠損への対応が必要

## 10. 成功基準

- [ ] IT・通信業界10〜15社のデータを自動収集できる
- [ ] 過去3年分の財務データを抽出できる
- [ ] 利益成長率を正しく計算できる
- [ ] 配当利回りを正しく計算できる
- [ ] ランキングをWebページで表示できる
- [ ] 2種類のグラフが正しく表示される
- [ ] コードが再利用可能な構造になっている
- [ ] 他の業界にも拡張可能な設計になっている

## 11. 将来の拡張性

### 11.1 機能拡張
- 他の業界への対応（自動車、金融、商社など）
- 他の指標の追加（ROE、自己資本比率など）
- 時系列グラフ（5年間の推移）
- 企業詳細ページ
- データのエクスポート機能（CSV、PDF）

### 11.2 自動化
- 定期実行（cron）
- 自動更新（新しい決算データの自動取得）
- メール通知（ランキング変動時）

### 11.3 高度な分析
- 業界平均との比較
- 相関分析
- 予測モデル
